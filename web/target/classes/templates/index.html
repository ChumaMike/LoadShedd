<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Load Shedding Interface</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .box { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        .stage-display { font-size: 2em; font-weight: bold; color: red; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
    <script>
        async function loadTowns() {
            const province = document.getElementById("province").value;
            const townSelect = document.getElementById("town");
            townSelect.innerHTML = "<option>Loading...</option>";

            if (!province) return;

            try {
                const response = await fetch('/towns/' + province);
                const towns = await response.json();

                townSelect.innerHTML = "";
                towns.forEach(t => {
                    // Places API returns objects {name: "...", province: "..."}
                    const option = document.createElement("option");
                    option.value = t.name;
                    option.text = t.name;
                    townSelect.appendChild(option);
                });
            } catch (e) {
                townSelect.innerHTML = "<option>Error loading towns</option>";
            }
        }
    </script>
</head>
<body>

<h1>WTC Load Shedding System</h1>

<div class="box">
    Current Stage: <span class="stage-display" th:text="${stage}">?</span>
</div>

<div class="box">
    <form method="post" action="/schedule">
        <label>Province:</label>
        <select id="province" name="province" onchange="loadTowns()">
            <option value="">-- Select Province --</option>
            <option th:each="p : ${provinces}" th:value="${p}" th:text="${p}"></option>
        </select>

        <label>Town:</label>
        <select id="town" name="town">
            <option value="">-- Select Province First --</option>
        </select>

        <button type="submit">Get Schedule</button>
    </form>
</div>

<div class="box" th:if="${schedule != null}">
    <h2>Schedule for <span th:text="${selectedTown}">Town</span></h2>

    <div th:each="day : ${schedule.days}">
        <h3 th:text="${day.name}">Day</h3> <ul>
        <li th:each="slot : ${day.slots}">
            <span th:text="${slot.start}">Start</span> - <span th:text="${slot.end}">End</span>
        </li>
    </ul>
    </div>
</div>

</body>
</html>